"use strict";((typeof self<"u"?self:this).webpackChunkMyLibrary=(typeof self<"u"?self:this).webpackChunkMyLibrary||[]).push([[4032,8052],{29071:function(R,u,t){t.r(u)},40930:function(R,u,t){t.r(u)},31775:function(R,u,t){t.r(u)},28534:function(R,u,t){t.r(u)},29013:function(R,u,t){Object.defineProperty(u,"__esModule",{value:!0}),u.default=r,t(4064);function r(e){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(N)return e.name;if(e!=null&&e.is_sql)return e.alias||e?.sql;if(e.alias)return e.alias;if(!e.name)return"";var d=e.name;return e!=null&&e.aggregate&&(d="".concat(e.aggregate,"(").concat(e.name,")"),e.aggregate==="DISCOUNT"&&(d="COUNT(DISTINCT ".concat(e.name,")"))),d}},82576:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.useGetVariationByField=g,t(20148),t(16165),t(37209),t(50754),t(2968);var e=t(68671),N=r(t(71997)),d=(0,N.default)(),M=new Map;function g(V,s,D){return new Promise(function(h,i){var p,l,a=d==null||(p=d.panel)===null||p===void 0||(l=p.datasource)===null||l===void 0?void 0:l.uid;if(!a){i("\u6570\u636E\u6E90uid\u65E0\u6CD5\u83B7\u53D6");return}var c=a+V+s,f=M.get(c);f&&h(f);var v={datasource_table:V,field:s,space_uid:D,datasource_uid:a,timestamp:String(new Date().getTime())};(0,e.getVariablesByField)(v).then(function(n){M.set(c,n),h(n)}).catch(function(n){n?.hideNormalError(),i(n?.message||"\u8BF7\u6C42\u53D8\u91CF\u5931\u8D25")})})}},71997:function(R,u,t){Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var r=t(30327),e=(0,r.defineStore)({id:"panelEditor",state:function(){return{panel:null}},actions:{savePanel(d){this.panel=d}}}),N=e;u.default=N},53232:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748),N=r(t(64375));t(88322),t(25528),t(58146),t(29071);var d=r(t(78310)),M=(0,e.defineComponent)({name:"CustomSwitch",props:{modelValue:{type:[Boolean,Number,String],default:!1},value:{type:[Boolean,Number,String],default:!1},isFlexChild:{type:Boolean,default:!1},showData:{type:Object,default:function(){return[{text:"\u5F00\u542F",value:!0},{text:"\u5173\u95ED",value:!1}]}},showText:{type:Array,default:function(){return[]}},backgroundColor:{type:String,default:"#fff"},activeBackgroundColor:{type:String,default:"#E1ECFF"},textColor:{type:String,default:"#63656E"},activeTextColor:{type:String,default:"#3A84FF"},itemWidth:{type:Number},activeBorderColor:{type:String,default:"#3A84FF"},borderColor:{type:String,default:"#C4C6CC"},height:{type:Number,default:26}},emits:["update:modelValue","change"],setup(g){var V=(0,e.ref)(g.modelValue||g.value),s=(0,e.ref)(0);return(0,e.watch)(function(){return[g.modelValue,g.value]},function(D){var h=(0,N.default)(D,2),i=h[0],p=h[1];V.value=i||p,s.value=g.showData.findIndex(function(l){return l.value===V.value})},{deep:!0,immediate:!0}),{val:V,activeIndex:s}},methods:{handleValueChange(g){this.activeIndex=g,this.val=this.showData[g].value,this.$emit("update:modelValue",this.val),this.$emit("change",this.val)}},render(){var g=this,V={width:"".concat(this.itemWidth?"".concat(this.itemWidth,"px"):"auto"),color:this.textColor,backgroundColor:this.backgroundColor,borderColor:this.borderColor},s={width:"".concat(this.itemWidth?"".concat(this.itemWidth,"px"):"auto"),color:this.activeTextColor,backgroundColor:this.activeBackgroundColor,borderColor:this.activeBorderColor};return(0,e.createVNode)("div",{class:"custom-switch",style:{height:"".concat(this.height,"px")}},[this.showData.length>0?this.showData.map(function(D,h){return(0,e.createVNode)("div",{class:(0,d.default)("custom-switch-button",{"pre-button":g.activeIndex-h===1,"active-button":g.activeIndex===h,"flex-1":g.isFlexChild}),style:g.val===D.value?s:V,key:h,onClick:function(){return g.handleValueChange(h)}},[g.showData.length<=2&&g.showText.length>0?g.showText[h]:D.text])}):"\u8BF7\u4F20\u5165\u6570\u636E"])}});u.default=M},57422:function(R,u,t){Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var r=t(70748),e=(0,r.defineComponent)({name:"ExpandBar",props:{modelValue:{type:Boolean,default:!0},label:String,handlerClass:{type:String,default:"mb-medium"},renderDirective:{type:String,default:"if"}},emits:["update:modelValue","change"],setup(N,d){var M=d.emit,g=d.slots,V=(0,r.ref)(N.modelValue);function s(){var D=!V.value;V.value=D,M("update:modelValue",D),M("change",D)}return function(){return(0,r.createVNode)("div",null,[(0,r.createVNode)("div",{onClick:s,class:"cursor-pointer flex-row align-items-center ".concat(N.handlerClass)},[(0,r.createVNode)("span",null,[N.label]),(0,r.createVNode)("i",{class:"bkvision-icon  font-big ".concat(V.value?"icon-arrows-up":"icon-arrows-down")},null)]),N.renderDirective==="show"?(0,r.withDirectives)((0,r.createVNode)("div",null,[g?.default()]),[[r.vShow,V.value]]):V.value?g?.default():""])}}});u.default=e},13564:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=r(t(62530));t(41465);var N=e.default;u.default=N},56350:function(R,u,t){t(81821),t(34),t(84873),t(1714);var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0,t(6125),t(20148),t(50754),t(35340),t(14775),t(37209),t(2968),t(19903),t(3105),t(17777),t(58146);var e=r(t(64375)),N=r(t(65809)),d=r(t(63638)),M=t(35385),g=t(64210),V=t(70748),s=t(12692),D=r(t(63595)),h=t(92244),i=t(71633),p=t(29113),l=t(11016),a=t(39456),c=t(81133),f=r(t(55760)),v=t(22247),n=r(t(32869)),m=t(36473),S=r(t(71997));function x(U,o){var C=Object.keys(U);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(U);o&&(b=b.filter(function(F){return Object.getOwnPropertyDescriptor(U,F).enumerable})),C.push.apply(C,b)}return C}function T(U){for(var o=1;o<arguments.length;o++){var C=arguments[o]!=null?arguments[o]:{};o%2?x(Object(C),!0).forEach(function(b){(0,d.default)(U,b,C[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(C)):x(Object(C)).forEach(function(b){Object.defineProperty(U,b,Object.getOwnPropertyDescriptor(C,b))})}return U}var B=(0,S.default)(),y=class extends(0,g.TSX)()(g.Vue){constructor(){super(...arguments),(0,d.default)(this,"panelModel",void 0),(0,d.default)(this,"expendList",[!0,!0]),(0,d.default)(this,"loading",!0),(0,d.default)(this,"loadingColumns",!0),(0,d.default)(this,"error",{type:"empty",msg:""}),(0,d.default)(this,"tableList",[]),(0,d.default)(this,"tableColumns",{}),(0,d.default)(this,"storage",{}),(0,d.default)(this,"formData",[]),(0,d.default)(this,"envs",[{id:"preview",name:"\u9884\u89C8\u73AF\u5883"},{id:"stag",name:"\u9884\u53D1\u5E03\u73AF\u5883"},{id:"prod",name:"\u751F\u4EA7\u73AF\u5883"}])}changePanelChartType(o){o==="time-series-mixed"?this.panelModel.query.length<2&&this.addQuery():this.panelModel.query.length>1&&this.formData.splice(1,1)}get chartMeta(){var o=this;return c.ChartSourceModule.chartSourceList.find(function(C){return C.id===o.panelModel.type})}created(){this.init()}init(){this.initData()}initData(){var o=this;return(0,N.default)(regeneratorRuntime.mark(function C(){return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:o.getTables(o.panelModel.datasource.uid).then(function(){var P;if(o.formData=[],o.expendList=[],o.formData=o.panelModel.query,o.panelModel.datasource&&(P=o.panelModel.query)!==null&&P!==void 0&&P.length&&B.panel.datasource.uid===o.panelModel.datasource.uid){for(var w=0;w<o.panelModel.query.length;w++)if(o.panelModel.query[w]){var I=o.panelModel.query[w].table;o.panelModel.query[w].ref_id||(o.panelModel.query[w].ref_id=i.Letters[w]),I&&(o.panelModel.datasource.type==="bkbase"&&o.getStorage(I,w),o.getColumnsData(I)),o.expendList.push(!0)}}else o.addQuery();o.panelModel.type==="time-series-mixed"&&o.panelModel.query.length<2&&(o.addQuery(),o.expendList=[!0,!0])}).finally(function(){o.loading=!1});case 1:case"end":return F.stop()}},C)}))()}addFormData(o){var C=m.DataSourceModule.datasourceMap.get(this.panelModel.datasource.type),b=C?.QueryConfig||s.QueryMysqlSimpleClass;return console.log(new b(o)),new b(o)}addQuery(){var o=this,C=i.Letters[this.formData.length],b=window.location.search.substr(1),F=D.default.parse(b),P=F.datasouce_table,w=this.addFormData(C);P&&(w.table=String(P),(0,V.nextTick)(function(){o.getColumns(0,w.table)})),this.formData.push(w),this.expendList.splice(this.formData.length,0,!0)}copyQuery(o,C){o.stopPropagation();var b=(0,p.deepClone)(C);b.ref_id=String.fromCharCode(97+this.formData.length).toUpperCase(),this.formData.push(b),this.expendList.splice(this.formData.length,0,!0)}deleteQuery(o,C){var b=this;o.stopPropagation(),console.log(C),(0,n.default)("\u63D0\u793A","\u786E\u8BA4\u8981\u5220\u9664",function(){b.formData.splice(C,1),b.expendList.splice(C,1);for(var F=0;F<b.formData.length;F++)b.formData[F].ref_id=String.fromCharCode(97+F).toUpperCase()})}getTables(o){var C=this;return this.error.msg="",this.loading=!0,(0,h.getTablesList)(o).then(function(b){C.tableList=b.map(function(F){return{value:F,label:F}})}).catch(function(b){C.error.msg=b?.message||"\u8BF7\u6C42\u51FA\u9519",C.error.type="500"})}getColumns(o,C){var b;!C||(((b=this.panelModel.datasource)===null||b===void 0?void 0:b.type)==="bkbase"&&this.getStorage(C,o),this.getColumnsData(C))}getColumnsData(o){var C=this;this.tableColumns[o]||(this.loadingColumns=!0,this.tableColumns[o]=[],(0,h.getTableColumns)(this.panelModel.datasource.uid,o).then(function(b){C.tableColumns[o]=b}).catch(function(b){C.tableColumns[o]=null,(0,v.Message)({theme:"error",message:b?.message||"\u52A0\u8F7D\u5B57\u6BB5\u5931\u8D25"})}).finally(function(){C.loadingColumns=!1}))}getStorage(o,C){var b=this;Object.prototype.hasOwnProperty.call(this.storage,o)||(0,h.getBkBaseStorage)(o).then(function(F){b.storage[o]=F.map(function(w){return{id:w,name:w}});var P=(0,e.default)(F,1);b.formData[C].storage=P[0]})}changeSqlModel(o,C){if(C){var b;o.raw_query=C;var F;if(o.time_filter.field&&o.time_filter.type==="datetime"){var P=this.formData[0].time_filter;F=P.category==="fixed"?[P.range.from,P.range.to]:a.QueryContextModule.timeRange}else F=a.QueryContextModule.timeRange;var w=(0,l.getTimeRange)(F),I=(0,e.default)(w,2),Q=I[0],A=I[1],O=a.QueryContextModule.variables;(0,h.renderSql)({query:T(T({},o),{},{datasource:{type:this.panelModel.datasource.type,uid:this.panelModel.datasource.uid},format:((b=this.chartMeta)===null||b===void 0?void 0:b.data_type)||o.format}),option:{range:{from:Q,to:A,raw:{from:F[0],to:F[1]},datetime_str:{from:(0,f.default)(Q).format("YYYY-MM-DD HH:mm:ss"),to:(0,f.default)(A).format("YYYY-MM-DD HH:mm:ss")}},variables:O}}).then(function(E){o.query_text=E}).catch(function(E){(0,v.Message)({theme:"error",message:E?.message||"\u6E32\u67D3sql\u51FA\u9519"}),o.query_text="select * from xxx"})}else(0,n.default)("\u5207\u6362\u7B80\u6613\u6A21\u5F0F","\u5207\u6362\u56DE\u7B80\u6613\u6A21\u5F0F\u5C06\u6E05\u9664\u60A8\u6240\u505A\u7684\u4EFB\u4F55\u6539\u52A8\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",function(){o.raw_query=C})}};(0,M.__decorate)([(0,g.Prop)()],y.prototype,"panelModel",void 0),(0,M.__decorate)([(0,g.Watch)("panelModel.type")],y.prototype,"changePanelChartType",null),y=(0,M.__decorate)([g.ComponentBase],y);var j=y;u.default=j},40297:function(R,u,t){Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var r=t(70748),e=t(22247),N=t(12692),d=e.Form.ComposeFormItem,M=e.Form.FormItem,g=(0,r.defineComponent)({name:"QueryLimit",props:{modelValue:{type:Object,default:function(){return new N.Limit}}},emits:["change","update:modelValue"],setup(V){return function(){return(0,r.createVNode)(M,{label:"\u9650\u5236"},{default:function(){return[(0,r.createVNode)(d,{class:"source-select-item"},{default:function(){return[(0,r.createVNode)(e.Input,{clearable:!0,style:"width:134px;","show-clear-only-hover":!0,placeholder:"\u8BF7\u8F93\u5165\u8FD4\u56DE\u6761\u6570",modelValue:V.modelValue.size,modelModifiers:{number:!0},"onUpdate:modelValue":function(i){return V.modelValue.size=i}},null)]}})]}})}}});u.default=g},23963:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(35340),t(58146),t(37209);var N=r(t(19291)),d=t(22247),M=t(12692),g=t(14712),V=r(t(35633));function s(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!(0,e.isVNode)(l)}var D=d.Select.Option,h=d.Form.FormItem,i=[{label:"\u5347\u5E8F",value:"ASC"},{label:"\u964D\u5E8F",value:"DESC"}],p=(0,e.defineComponent)({name:"QueryOrder",props:{modelValue:{type:Array,default:function(){return[]}},list:{type:Array,default:[]}},emits:["change","update:modelValue"],setup(l,a){var c=a.emit,f=(0,e.computed)({get:function(){return l.modelValue},set:function(S){return c("update:modelValue",S)}});function v(m){f.value.push(new M.Order(m,"ASC"))}function n(m){f.value.splice(m,1)}return{formData:f,add:v,remove:n}},render(){var l=this;return(0,e.createVNode)(h,{label:"\u6392\u5E8F",class:"bv-form-item-wrap"},{default:function(){return[(0,e.createVNode)(N.default,{list:l.formData,handle:".dragging-handle",tag:"div","item-key":"name",class:"flex-row align-items-center flex-wrap"},{item:function(f){var v,n=f.element,m=f.index;return(0,e.createVNode)("div",{key:n.name+m,class:"mr-normal bv-has-btn-box dragging-handle position-relative bk-compose-form-item"},[(0,e.createVNode)(V.default,{modelValue:n.name,"onUpdate:modelValue":function(x){return n.name=x},options:l.list,placeholder:"\u8BF7\u9009\u62E9\u6392\u5E8F\u5B57\u6BB5",style:"width:134px;"},null),(0,e.createVNode)(d.Select,{placeholder:"\u8BF7\u9009\u62E9\u6392\u5E8F",class:"hide-select-angular",modelValue:n.order,"onUpdate:modelValue":function(x){return n.order=x},clearable:!1,"id-key":"name",style:"width:100px"},s(v=i.map(function(S,x){return(0,e.createVNode)(D,{value:S.value,label:S.label,key:x},null)}))?v:{default:function(){return[v]}}),(0,e.createVNode)("div",{onClick:function(){return l.remove(m)},class:"bv-target-input-btn flex-row align-items-center"},[(0,e.createVNode)("i",{class:"bkvision-icon icon-guanbi_mianxing"},null)])])},footer:function(){return(0,e.createVNode)("div",{class:"bv-target-add-btn"},[(0,e.createVNode)(g.Plus,null,null),(0,e.createVNode)(V.default,{class:"bv-add-select",onChange:l.add,options:l.list,type:"add",placeholder:"\u8BF7\u9009\u62E9\u6392\u5E8F\u5B57\u6BB5"},null)])}})]}})}});u.default=p},84875:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(34),t(37209),t(99057),t(14827),t(9100),t(58146);var N=t(12692),d=t(22247),M=t(14712),g=r(t(78310)),V=t(95939),s=t(2769),D=r(t(29013)),h=d.Tab.TabPanel,i=d.Radio.Group,p=(0,e.defineComponent)({name:"QueryTargetInput",props:{modelValue:{type:Object,default:function(){return new N.QueryColumn}},aliasList:{type:Array,default:function(){return[]}},type:{type:String,default:""},renderType:{type:String,default:""},list:{type:Array,default:function(){return[]}}},emits:["change","update:modelValue","add","remove"],setup(l,a){var c=a.emit,f=(0,e.ref)("normal"),v=(0,e.ref)(null),n=(0,e.ref)(""),m=(0,e.ref)(!1),S=(0,e.ref)(""),x=(0,e.ref)(!1),T=(0,e.ref)(new N.QueryColumn(l.modelValue)),B=(0,e.computed)(function(){return(0,V.getAggregationOptions)(T.value.type)});(0,e.watch)(function(){return l.modelValue},function(O){T.value=new N.QueryColumn(O)},{deep:!0}),(0,e.watch)(function(){return f.value},function(O){T.value.is_sql=O==="sql"});var y=(0,e.ref)((0,D.default)(T.value)),j=(0,e.computed)(function(){var O;return l.renderType==="targets"?O=l.list:O=l.list.filter(function(E){return E.type!=="f(x)"}),S.value?O.filter(function(E){var L=E.name;return String(L).toLowerCase().includes(String(S.value).toLowerCase())}):O}),U=(0,e.computed)(function(){if(l.type==="add"){if(T.value.is_sql){if(!T.value.sql)return!0}else if(!T.value.name)return!0}return!1});function o(){if(l.type==="add"){c("add",(0,s.cloneDeep)(T.value)),b();return}y.value=(0,D.default)(T.value),c("update:modelValue",T.value),Object.assign(l.modelValue,(0,s.cloneDeep)(T.value)),c("change",T.value),C()}function C(){A(),v.value.hide()}function b(){C(),T.value=new N.QueryColumn(l.modelValue)}function F(O){var E=O.isShow;E.value=E}function P(O){var E=O.type,L=O.name;T.value.name=L,T.value.type=E,console.log(E,L,T.value)}function w(){c("remove")}function I(){x.value=!0,n.value=T.value.alias}function Q(){if(T.value.alias===n.value){x.value=!1;return}if(n.value&&l.aliasList.length&&l.aliasList.includes(n.value)){(0,d.Message)({theme:"error",message:"\u522B\u540D\u91CD\u590D\uFF0C\u8BF7\u91CD\u547D\u540D"});return}T.value.alias=n.value,x.value=!1}function A(){x.value=!1,n.value=""}return{isShow:m,targetName:y,disableEnsure:U,formData:T,active:f,keyword:S,options:j,aggregationOptions:B,isInputName:x,aliasName:n,popoverRef:v,ensure:o,cancel:b,handleAfterHidden:F,changeColumn:P,remove:w,setAlias:I,cancelAlias:A,ensureAlias:Q}},render(){var l=this;return(0,e.createVNode)("div",{class:"dragging-handle"},[(0,e.createVNode)(d.Popover2,{ref:"popoverRef",isShow:this.isShow,"on-after-hidden":this.handleAfterHidden,trigger:"click",theme:"light bv-target-popover",placement:"bottom-start",height:342},{default:function(){return l.type==="add"?(0,e.createVNode)("div",{class:"bv-target-add-btn"},[(0,e.createVNode)(M.Plus,null,null)]):(0,e.createVNode)("div",{class:"bv-target-input"},[(0,e.createVNode)("div",{class:"bv-target-input-text"},[(0,e.createVNode)("div",{class:"text-ov"},[l.targetName])]),(0,e.createVNode)("div",{class:"bv-target-input-btn flex-row align-items-center"},[(0,e.createVNode)("i",{onClick:l.remove,class:"bkvision-icon icon-guanbi_mianxing"},null)])])},content:function(){var c;return(0,e.createVNode)("div",{class:"full-height flex-column"},[(0,e.createVNode)(d.Tab,{class:"bk-tab-flex bv-target-tab  bv-target-has-alias full-height overflow-auto",active:l.active,"onUpdate:active":function(v){return l.active=v},"label-height":38,type:"unborder-card"},{default:function(){return[(0,e.createVNode)(h,{label:"\u666E\u901A\u6A21\u5F0F",name:"normal"},{default:function(){return[(0,e.createVNode)("div",{class:"flex-row full-height pt-min"},[(0,e.createVNode)("div",{class:"bv-target-select flex-column full-height flex-1"},[(0,e.createVNode)("div",{class:"flex-row align-items-center justify-content-between mb-min"},[(0,e.createVNode)("strong",{class:" pl-normal pr-xxl text-ov"},[(0,e.createTextVNode)("\u5B57\u6BB5\u9009\u62E9")]),(0,e.createVNode)("div",{class:(0,g.default)("bv-target-search flex-row align-items-center",{"bv-target-search-active":l.keyword})},[(0,e.createVNode)(d.Input,{modelValue:l.keyword,"onUpdate:modelValue":function(m){return l.keyword=m},behavior:"simplicity",clearable:!0,placeholder:"\u641C\u7D22",size:"small"},{suffix:function(){return(0,e.createVNode)("span",{class:"input-icon"},[(0,e.createVNode)(M.Search,null,null)])}})])]),(0,e.createVNode)("div",{class:"flex-1 overflow-auto"},[(0,e.createVNode)("div",{class:"full-height overflow-auto"},[(c=l.options)!==null&&c!==void 0&&c.length?l.options.map(function(n){var m;return(0,e.createVNode)("div",{key:n.name,onClick:function(){return l.changeColumn(n)},class:(0,g.default)("bv-target-item flex-row align-items-center justify-content-between",{"bv-target-item-active":((m=l.formData)===null||m===void 0?void 0:m.name)===n.name})},[(0,e.createVNode)("div",{class:"flex-1 mr-normal text-ov"},[n.name]),(0,e.createVNode)("div",null,[n.type])])}):(0,e.createVNode)(d.Exception,{class:"full-height  align-items-center justify-content-center",scene:"part",type:"empty"},null)])])]),l.renderType==="targets"?(0,e.createVNode)("div",{class:"bv-target-radio-box flex-column full-height"},[(0,e.createVNode)("div",{class:"bv-target-radio-title"},[(0,e.createTextVNode)("\u805A\u5408\u51FD\u6570 (\u53EF\u9009)")]),(0,e.createVNode)(i,{modelValue:l.formData.aggregate,"onUpdate:modelValue":function(m){return l.formData.aggregate=m}},{default:function(){return[(0,e.createVNode)("div",{class:"flex-1 overflow-auto "},[l.aggregationOptions.map(function(m,S){return(0,e.createVNode)("div",{class:"pb-small",key:m.id+S},[(0,e.createVNode)(d.Radio,{label:m.id},{default:function(){return[m.name]}})])}),(0,e.createVNode)("div",{class:"pb-small"},[(0,e.createVNode)(d.Radio,{label:""},{default:function(){return[(0,e.createTextVNode)("\u65E0")]}})])])]}})]):""])]}}),(0,e.createVNode)(h,{label:"\u81EA\u5B9A\u4E49SQL",name:"sql"},{default:function(){return[(0,e.createVNode)("div",{class:"full-height p-normal"},[(0,e.createVNode)(d.Input,{modelValue:l.formData.sql,"onUpdate:modelValue":function(m){return l.formData.sql=m},placeholder:l.formData.name,type:"textarea",class:"full-height"},null)])]}})]},setting:function(){return l.isInputName?(0,e.createVNode)("div",{class:"flex-1 flex-row align-items-center"},[(0,e.createVNode)(d.Input,{class:"flex-1",behavior:"simplicity",style:"width:160px;",size:"small",placeholder:"\u8BF7\u8F93\u5165",clearable:!0,maxlength:20,modelValue:l.aliasName,"onUpdate:modelValue":function(n){return l.aliasName=n}},null),(0,e.createVNode)("div",{class:"flex-row align-items-center"},[(0,e.createVNode)(d.Button,{text:!0,theme:"success",onClick:l.ensureAlias},{default:function(){return[(0,e.createVNode)("i",{class:"font-large bkvision-icon icon-check-small mr-min"},null)]}}),(0,e.createVNode)(d.Button,{text:!0,onClick:l.cancelAlias},{default:function(){return[(0,e.createVNode)("i",{class:"font-large bkvision-icon icon-close-small mr-min"},null)]}})])]):(0,e.createVNode)("div",{class:"text-link cursor-pointer font-small text-ov mr-xl",style:"max-width:180px;",onClick:l.setAlias},[l.formData.alias?"".concat(l.formData.alias):(0,e.createVNode)(e.Fragment,null,[(0,e.createVNode)("i",{class:"bkvision-icon icon-bianji"},null),(0,e.createTextVNode)("\u5B57\u6BB5\u522B\u540D")])])}}),(0,e.createVNode)("div",{class:"bv-target-footer flex-row justify-content-end align-items-center"},[(0,e.createVNode)(d.Button,{onClick:l.ensure,disabled:l.disableEnsure,size:"small",theme:"primary",class:"mr-normal"},{default:function(){return[(0,e.createTextVNode)("\u786E\u5B9A")]}}),(0,e.createVNode)(d.Button,{onClick:l.cancel,size:"small"},{default:function(){return[(0,e.createTextVNode)("\u53D6\u6D88")]}})])])}})])}});u.default=p},76948:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(58146),t(35340);var N=t(22247),d=r(t(84875)),M=r(t(19291));t(40930);var g=N.Form.FormItem,V=(0,e.defineComponent)({name:"QueryTargets",props:{modelValue:{type:Array,default:function(){return[]}},type:{type:String,default:""},renderType:{type:String,default:""},list:{type:Array,default:[]}},emits:["change","update:modelValue"],setup(s,D){var h=D.emit,i=(0,e.computed)({get:function(){return s.modelValue},set:function(f){return h("update:modelValue",f)}}),p=(0,e.computed)(function(){return i.value.map(function(c){return c.alias})});function l(c){i.value.push(c)}function a(c){i.value.splice(c,1)}return{formData:i,aliasList:p,add:l,remove:a}},render(){var s=this;return(0,e.createVNode)(g,{required:this.renderType==="targets",label:this.renderType==="targets"?this.$t("\u6307\u6807"):this.$t("\u7EF4\u5EA6"),class:"bv-form-item-wrap"},{default:function(){return[(0,e.createVNode)(M.default,{list:s.formData,handle:".dragging-handle",tag:"div","item-key":"name",class:"flex-row align-items-center flex-wrap"},{item:function(i){var p=i.element,l=i.index;return(0,e.createVNode)(d.default,{key:p.name+l,modelValue:p,"onUpdate:modelValue":function(c){return p=c},onRemove:function(){return s.remove(l)},renderType:s.renderType,list:s.list,aliasList:s.aliasList},null)},footer:function(){return(0,e.createVNode)(d.default,{type:"add",onAdd:s.add,renderType:s.renderType,list:s.list,aliasList:s.aliasList},null)}})]}})}});u.default=V},5642:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0,t(34),t(37209),t(14775),t(58146);var e=t(70748),N=r(t(64375)),d=t(22247),M=t(95939);t(31775);var g=t(11016),V=r(t(55760));function s(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!(0,e.isVNode)(l)}var D=d.Form.FormItem,h=d.Select.Option,i="YYYY-MM-DD HH:mm:ss",p=(0,e.defineComponent)({name:"QueryTime",props:{modelValue:{type:Object,default:[]},list:{type:Array,default:[]},handleTimeRangeChange:{type:Function},getTimeRangeFromFilter:{type:Function}},emits:["change","update:modelValue"],setup(l,a){var c=a.emit,f=(0,e.computed)({get:function(){return l.modelValue},set:function(y){return c("update:modelValue",y)}}),v=(0,e.computed)({get:function(){var y=f.value.range,j=y.from,U=y.to;return[j,U].join("--")},set:function(y){var j=y.split("--"),U=(0,N.default)(j,2),o=U[0],C=U[1];f.value.range={from:o,to:C}}}),n=(0,e.shallowRef)([(0,V.default)().startOf("d").toDate(),new Date]),m=(0,e.computed)(function(){return l.list.filter(function(B){return!!M.TIME_TYPE.find(function(y){var j;return y.toLowerCase()===((j=B.type)===null||j===void 0?void 0:j.toLowerCase())})})});function S(B){switch(B){case"fixed":{n.value=[(0,V.default)().startOf("d").toDate(),new Date];var y=(0,N.default)(n.value,2),j=y[0],U=y[1];f.value.range={from:(0,V.default)(j).format(i),to:(0,V.default)(U).format(i)}}break;case"dynamic_fixed":f.value.range={from:"now/d",to:"now/d"};break;default:f.value.range={from:"now/d",to:"now/d"};break}}function x(B){var y=(0,N.default)(B,2),j=y[0],U=y[1];f.value.range={from:(0,V.default)(j).format(i),to:(0,V.default)(U).format(i)}}function T(B){B||(f.value.field="");var y=m.value.find(function(j){return j.name===B});f.value.type=y.type}return{formData:f,options:m,timeRangeStr:v,timeRangeDate:n,changeCategory:S,changeDate:x,changeColumn:T}},render(){var l,a,c=this,f=function(){var n;switch(c.formData.category){case"fixed":return(0,e.createVNode)(d.DatePicker,{onChange:c.changeDate,modelValue:c.timeRangeDate,"onUpdate:modelValue":function(S){return c.timeRangeDate=S},class:"full-width",format:"yyyy-MM-dd HH:mm:ss",type:"daterange",placeholder:"\u9009\u62E9\u65E5\u671F\u8303\u56F4",clearable:!1},null);case"dynamic_fixed":return(0,e.createVNode)(d.Select,{class:"full-width",modelValue:c.timeRangeStr,"onUpdate:modelValue":function(S){return c.timeRangeStr=S},clearable:!1},s(n=g.SHORTCUTS.map(function(m,S){return(0,e.createVNode)(h,{label:m.text,value:m.short.join("--"),key:S},null)}))?n:{default:function(){return[n]}});default:return""}};return(0,e.createVNode)(D,{label:"\u65F6\u95F4"},{default:function(){return[(0,e.createVNode)("div",{class:"flex-row  align-items-center"},[(0,e.createVNode)("div",{class:"bv-query-time-select  flex-row align-items-center"},[(0,e.createVNode)("div",{class:"target-select-set"},[(0,e.createTextVNode)("\u65F6\u95F4\u5B57\u6BB5")]),(0,e.createVNode)(d.Select,{placeholder:c.$t("\u8BF7\u9009\u62E9\u65F6\u95F4\u5B57\u6BB5"),modelValue:c.formData.field,"onUpdate:modelValue":function(m){return c.formData.field=m},onChange:c.changeColumn,filterable:!0,allowCreate:!0,popoverMinWidth:268,class:"flex-1"},s(l=c.options.map(function(n){return(0,e.createVNode)(h,{label:n.name,key:n.name,value:n.name},{default:function(){return[(0,e.createVNode)("div",{class:"flex-row align-items-center justify-content-between"},[(0,e.createVNode)("div",{class:"flex-1 text-ov mr-normal"},[n.name]),(0,e.createVNode)("div",{style:{fontSize:".8em"}},[n.type])])]}})}))?l:{default:function(){return[l]}})]),c.formData.field?(0,e.createVNode)("div",{class:"bv-query-time-select flex-row align-items-center"},[(0,e.createVNode)("div",{class:"target-select-set"},[(0,e.createTextVNode)("\u805A\u5408\u89C4\u5219")]),(0,e.createVNode)(d.Select,{modelValue:c.formData.aggregate,"onUpdate:modelValue":function(m){return c.formData.aggregate=m},filterable:!0,clearable:!1,class:"flex-1"},s(a=M.TimeAggregateList.map(function(n){return(0,e.createVNode)(h,{key:n.id,value:n.id,label:n.name},null)}))?a:{default:function(){return[a]}})]):""]),c.formData.field?(0,e.createVNode)("div",{class:"flex-row  align-items-center mt-normal"},[(0,e.createVNode)("div",{class:"bv-query-time-select flex-row align-items-center"},[(0,e.createVNode)("div",{class:"target-select-set"},[(0,e.createTextVNode)("\u65F6\u95F4\u8303\u56F4")]),(0,e.createVNode)(d.Select,{modelValue:c.formData.category,"onUpdate:modelValue":function(m){return c.formData.category=m},onChange:c.changeCategory,filterable:!0,clearable:!1,class:"flex-1"},{default:function(){return[(0,e.createVNode)(h,{value:"dynamic",label:"\u8DDF\u968F\u5168\u5C40\u65F6\u95F4\u9009\u62E9\u5668"},null),(0,e.createVNode)(h,{value:"fixed",label:"\u56FA\u5B9A\u65F6\u95F4\u8303\u56F4"},null),(0,e.createVNode)(h,{value:"dynamic_fixed",label:"\u52A8\u6001\u8303\u56F4"},null),(0,e.createVNode)(h,{value:"no limit",label:"\u4E0D\u9650\u5236\u8303\u56F4"},null)]}})]),(0,e.createVNode)("div",{class:"flex-row align-items-center",style:"width:318px;"},[f()])]):""]}})}});u.default=p},14799:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(35340);var N=t(22247),d=r(t(42519));t(28534);var M=r(t(19291)),g=N.Form.FormItem,V=(0,e.defineComponent)({name:"QueryWhere",props:{modelValue:{type:Array,default:function(){return[]}},list:{type:Array,default:[]}},emits:["change","update:modelValue"],setup(s,D){var h=D.emit,i=(0,e.computed)({get:function(){return s.modelValue},set:function(c){return h("update:modelValue",c)}});function p(a){i.value.push(a)}function l(a){i.value.splice(a,1)}return{formData:i,add:p,remove:l}},render(){var s=this;return(0,e.createVNode)(g,{label:"\u8FC7\u6EE4",class:"bv-form-item-wrap"},{default:function(){return[(0,e.createVNode)(M.default,{list:s.formData,handle:".dragging-handle",tag:"div","item-key":"name",class:"flex-row align-items-center flex-wrap"},{item:function(i){var p=i.element,l=i.index;return(0,e.createVNode)(d.default,{key:p.params[0]+l,modelValue:p,"onUpdate:modelValue":function(c){return p=c},onRemove:function(){return s.remove(l)},list:s.list},null)},footer:function(){return(0,e.createVNode)(d.default,{type:"add",onAdd:s.add,list:s.list},null)}})]}})}});u.default=V},42519:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(58146),t(4064),t(37209),t(25181),t(34),t(99057),t(14827),t(9100);var N=t(12692),d=t(22247),M=t(14712),g=r(t(78310)),V=t(29113),s=t(2769),D=r(t(53232)),h=t(95939),i=d.Form.ComposeFormItem,p=d.Tab.TabPanel,l=(0,e.defineComponent)({name:"QueryWhereInput",props:{modelValue:{type:Object,default:function(){return new N.Where}},type:{type:String,default:""},renderType:{type:String,default:""},list:{type:Array,default:function(){return[]}},rawQuery:{type:Boolean,default:!1}},emits:["change","update:modelValue","add","remove"],setup(a,c){var f=c.emit,v=(0,e.ref)("normal"),n=(0,e.ref)(null),m=(0,e.ref)(!1),S=(0,e.ref)(""),x=(0,e.ref)(new N.Where),T=(0,e.ref)([]);(0,e.watch)(function(){return a.modelValue},function(A){x.value=(0,V.deepClone)(A)},{immediate:!0,deep:!0}),(0,e.watch)(function(){return v.value},function(A){x.value.is_sql=A==="sql"});var B=function(){if(x.value.is_sql)return x.value.sql;var O=x.value.params||[];if(T.value.length){var E=T.value.map(function(L){return"'".concat(L,"'")});return"".concat(O[0]?"".concat(O[0]," "):"").concat(O[1]?"".concat(O[1]," "):""," (").concat(E.toString(),")")}return"".concat(O[0]?"".concat(O[0]," "):"").concat(O[1]?"".concat(O[1]," "):"").concat(O[2]?"".concat(O[2]):"")},y=(0,e.ref)(B()),j=(0,e.computed)(function(){return S.value?a.list.filter(function(A){var O=A.name,E=A.type;return String(O).toLowerCase().includes(String(S.value).toLowerCase())&&E!=="f(x)"}):a.list.filter(function(A){return A.type!=="f(x)"})}),U=(0,e.computed)(function(){if(a.type==="add"){if(x.value.is_sql){if(!x.value.sql)return!0}else if(x.value.is_sql&&!x.value.sql||!x.value.params[0]||!x.value.params[1])return!0}return!1}),o=(0,e.ref)([]);function C(){(0,e.nextTick)(function(){f("update:modelValue",x.value),Object.assign(a.modelValue,(0,s.cloneDeep)(x.value)),f("change",x.value)})}function b(){if(a.type==="add"){f("add",(0,s.cloneDeep)(x.value)),F(),x.value=new N.Where;return}y.value=B(),C(),F()}function F(){n.value.hide()}function P(A){var O=A.isShow;O.value=O}function w(A){var O=A.type,E=A.name;x.value.params[0]=E,x.value.type=O,console.log(O,E,x.value)}function I(){f("remove")}function Q(){var A=T.value.map(function(O){return"'".concat(O,"'")});x.value.params[2]="(".concat(A.toString(),")"),C()}return{isShow:m,targetName:y,disableEnsure:U,formData:x,active:v,keyword:S,options:j,filterValues:T,variable:o,popoverRef:n,ensure:b,cancel:F,updateFormData:C,handleAfterHidden:P,changeColumn:w,changeFilterValues:Q,remove:I}},render(){var a=this,c=function(){if(!a.formData.params[1].includes("NULL"))return a.formData.params[1].includes("IN")?(0,e.createVNode)(d.TagInput,{class:"bv-query-where-tag-input",allowCreate:!0,saveKey:"displayLabel",displayKey:"name",searchKey:"name",onChange:a.changeFilterValues,modelValue:a.filterValues,"onUpdate:modelValue":function(n){return a.filterValues=n},hasDeleteIcon:!0,list:a.variable},null):(0,e.createVNode)(d.Input,{modelValue:a.formData.params[2],"onUpdate:modelValue":function(n){return a.formData.params[2]=n},onChange:a.updateFormData,style:"width:120px;",placeholder:a.$t("\u8BF7\u8F93\u5165\u503C"),clearable:!1},null)};return(0,e.createVNode)("div",{class:"bv-has-btn-box dragging-handle position-relative flex-row align-items-center mr-normal"},[(0,e.createVNode)(d.Popover2,{ref:"popoverRef",isShow:this.isShow,"on-after-hidden":this.handleAfterHidden,trigger:"click",theme:"light bv-target-popover",placement:"bottom-start",height:322},{default:function(){return a.type==="add"?(0,e.createVNode)("div",{class:"bv-target-add-btn"},[(0,e.createVNode)(M.Plus,null,null)]):a.formData.is_sql?(0,e.createVNode)("div",{class:"bv-target-input"},[(0,e.createVNode)("div",{class:"bv-target-input-text"},[(0,e.createVNode)("div",{class:"text-ov"},[a.targetName])])]):(0,e.createVNode)("div",{class:"bv-target-input bv-query-where-select"},[(0,e.createVNode)("div",{class:"bv-target-input-text"},[(0,e.createVNode)("div",{class:"text-ov"},[a.modelValue.params[0]])])])},content:function(){var v;return(0,e.createVNode)("div",{class:"full-height flex-column"},[(0,e.createVNode)(d.Tab,{class:"bk-tab-flex bv-target-tab full-height overflow-auto",active:a.active,"onUpdate:active":function(m){return a.active=m},"label-height":38,type:"unborder-card"},{default:function(){return[(0,e.createVNode)(p,{label:"\u666E\u901A\u6A21\u5F0F",name:"normal"},{default:function(){return[(0,e.createVNode)("div",{class:"full-height pt-min"},[(0,e.createVNode)("div",{class:"bv-target-select flex-column full-height"},[(0,e.createVNode)("div",{class:"flex-row align-items-center justify-content-between mb-min"},[(0,e.createVNode)("strong",{class:" pl-normal pr-normal"},[(0,e.createTextVNode)("\u5B57\u6BB5\u9009\u62E9")]),(0,e.createVNode)(d.Input,{modelValue:a.keyword,"onUpdate:modelValue":function(x){return a.keyword=x},behavior:"simplicity",clearable:!0,size:"small",class:"flex-1"},{suffix:function(){return(0,e.createVNode)("span",{class:"input-icon"},[(0,e.createVNode)(M.Search,null,null)])}})]),(0,e.createVNode)("div",{class:"flex-1 overflow-auto"},[(0,e.createVNode)("div",{class:"full-height overflow-auto"},[(v=a.options)!==null&&v!==void 0&&v.length?a.options.map(function(S){return(0,e.createVNode)("div",{key:S.name,onClick:function(){return a.changeColumn(S)},class:(0,g.default)("bv-target-item flex-row align-items-center justify-content-between",{"bv-target-item-active":a.formData.params[0]===S.name})},[(0,e.createVNode)("div",{class:"flex-1 mr-normal text-ov"},[S.name]),(0,e.createVNode)("div",null,[S.type])])}):(0,e.createVNode)(d.Exception,{class:"full-height  align-items-center justify-content-center",scene:"part",type:"empty"},null)])])])])]}}),(0,e.createVNode)(p,{label:"\u81EA\u5B9A\u4E49SQL",name:"sql"},{default:function(){return[(0,e.createVNode)("div",{class:"full-height full-height p-normal flex-column"},[(0,e.createVNode)(D.default,{isFlexChild:!0,modelValue:a.formData.filter_type,"onUpdate:modelValue":function(x){return a.formData.filter_type=x},showData:[{text:"WHERE",value:"WHERE"},{text:"HAVING",value:"HAVING"}],class:"full-width mb-normal"},null),(0,e.createVNode)(d.Input,{modelValue:a.formData.sql,"onUpdate:modelValue":function(x){return a.formData.sql=x},placeholder:a.formData.name,type:"textarea",class:"flex-1"},null)])]}})]}}),(0,e.createVNode)("div",{class:"bv-target-footer flex-row justify-content-end align-items-center"},[(0,e.createVNode)(d.Button,{size:"small",onClick:a.ensure,disabled:a.disableEnsure,theme:"primary",class:"mr-normal"},{default:function(){return[(0,e.createTextVNode)("\u786E\u5B9A")]}}),(0,e.createVNode)(d.Button,{size:"small",onClick:a.cancel},{default:function(){return[(0,e.createTextVNode)("\u53D6\u6D88")]}})])])}}),this.type!=="add"?(0,e.createVNode)(e.Fragment,null,[this.formData.is_sql?"":(0,e.createVNode)(i,null,{default:function(){return[(0,e.createVNode)(d.Select,{class:"bv-query-where-operation hide-select-angular",modelValue:a.formData.params[1],"onUpdate:modelValue":function(n){return a.formData.params[1]=n},onChange:a.updateFormData,clearable:!1,style:{width:"".concat(a.formData.params[1].length*12+20,"px!important")},popoverMinWidth:100,list:h.operationList},null),c()]}}),(0,e.createVNode)("div",{class:(0,g.default)("bv-target-input-btn flex-row align-items-center",{"mr-normal":this.formData.is_sql})},[(0,e.createVNode)("i",{onClick:this.remove,class:"bkvision-icon icon-guanbi_mianxing"},null)])]):""])}});u.default=l},35633:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(58146),t(9100),t(37209);var N=t(22247),d=r(t(78310));function M(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!(0,e.isVNode)(s)}var g=N.Select.Option,V=(0,e.defineComponent)({name:"SqlSelect",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},clearable:{type:Boolean,default:!1},type:{type:String,default:""},size:{type:String,default:"default"},options:{type:Array,default:[]},isNotAllowCreate:Boolean},emits:["update:modelValue","change"],setup(s,D){var h=D.emit,i=(0,e.ref)(s.modelValue),p=(0,e.ref)(""),l=(0,e.ref)(!s.options.length),a=(0,e.ref)(null);function c(n){h("update:modelValue",n),h("change",n),s.type==="add"&&(0,e.nextTick)(function(){i.value="",p.value=""})}function f(){s.options.length&&(l.value=!1),p.value=""}function v(){!p.value||(c(p.value),f(),a.value.hidePopover())}return{target:i,isInput:l,inputValue:p,selectRef:a,change:c,cancelInput:f,ensureInput:v}},render(){var s=this,D={default:function(){return s.options.map(function(i){return(0,e.createVNode)(g,{key:i.name,label:i.name,value:i.name},{default:function(){return[(0,e.createVNode)("div",{class:"flex-row align-items-center justify-content-between"},[(0,e.createVNode)("span",null,[i.name]),(0,e.createVNode)("span",{style:"font-size:.8em;"},[i.type])])]}})})}};return this.isNotAllowCreate||Object.assign(D,{extension:function(){return s.isInput?(0,e.createVNode)("div",{class:"flex-row justify-content-between align-items-center pl-min pr-small full-width"},[(0,e.createVNode)(N.Input,{class:"flex-1",modelValue:s.inputValue,"onUpdate:modelValue":function(p){return s.inputValue=p},clearable:!0},null),(0,e.createVNode)("div",{class:"flex-row align-items-center ml-normal font-large"},[(0,e.createVNode)("i",{onClick:s.ensureInput,class:(0,d.default)("bkvision-icon icon-check-small mr-small cursor-pointer",{"disabled-text":!s.inputValue}),style:"color:#2DCB56;"},null),(0,e.createVNode)("i",{onClick:s.cancelInput,class:"bkvision-icon icon-close-small cursor-pointer"},null)])]):(0,e.createVNode)("div",{onClick:function(){s.isInput=!0,s.inputValue=""},class:"flex-row align-items-center justify-content-center full-width cursor-pointer"},[(0,e.createVNode)("i",{class:"bkvision-icon icon-add-line mr-small"},null),(0,e.createVNode)("div",null,[(0,e.createTextVNode)("\u81EA\u5B9A\u4E49\u5B57\u6BB5")])])}}),(0,e.createVNode)(N.Select,{class:"hide-select-angular",modelValue:s.target,"onUpdate:modelValue":function(i){return s.target=i},onChange:this.change,popoverOptions:{autoVisibility:!1},clearable:this.clearable,filterable:!0,allowCreate:!1,inputSearch:!1,ref:"selectRef",size:this.size,placeholder:this.placeholder,customContent:!0,popoverMinWidth:220},M(D)?D:{default:function(){return[D]}})}});u.default=V},18809:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(14775),t(37209),t(35340);var N=t(12692);t(28534);var d=r(t(19291)),M=t(22247),g=t(14712),V=r(t(35633)),s=r(t(78186)),D=M.Form.FormItem,h=(0,e.defineComponent)({name:"VariationDict",props:{modelValue:{type:Array,default:function(){return[]},required:!0},table:{type:String,required:!0},list:{type:Array,default:[],required:!0}},emits:["update:modelValue","change"],setup(i,p){var l=p.emit,a=(0,e.computed)({get:function(){return i.modelValue},set:function(n){return l("change",n),l("update:modelValue",n),n}});(0,e.watch)(function(){return i.table},function(){},{immediate:!0});function c(v){var n=i.list.find(function(m){return m.name===v});!n||a.value.push(new N.QueryVariation(v,n.type))}function f(v){a.value.splice(v,1)}return{formData:a,add:c,remove:f}},render(){var i=this;return(0,e.createVNode)(D,{label:"\u7B5B\u9009\u9879",class:"bv-form-item-wrap"},{default:function(){return[(0,e.createVNode)(d.default,{list:i.formData,handle:".dragging-handle",tag:"div","item-key":"name",class:"flex-row align-items-center flex-wrap"},{item:function(a){var c=a.element,f=a.index;return(0,e.createVNode)(s.default,{key:f,modelValue:c,"onUpdate:modelValue":function(n){return c=n},table:i.table,list:i.list,onRemove:function(){return i.remove(f)}},null)},footer:function(){return(0,e.createVNode)("div",{class:"bv-target-add-btn"},[(0,e.createVNode)(g.Plus,null,null),(0,e.createVNode)(V.default,{class:"bv-add-select",type:"add",onChange:i.add,options:i.list},null)])}})]}})}});u.default=h},97193:function(R,u,t){Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var r=t(70748);t(9100),t(37209),t(2968),t(19903),t(81821),t(6504),t(58146);var e=t(12692);t(28534);var N=t(22247),d=t(68671),M=N.Form.FormItem,g=(0,r.defineComponent)({name:"VariationDictCreator",props:{isShow:Boolean,params:{type:Object}},emits:["refresh","close"],setup(V,s){var D=s.emit,h=(0,r.ref)(l()),i=(0,r.ref)(!1),p=(0,r.ref)(null);function l(){var f=new e.VariableForm;return Object.assign(f,V.params),f}function a(){D("close"),h.value=l()}function c(){var f;(f=p.value)===null||f===void 0||f.validate().then(function(){i.value=!0,(0,d.quickCreateVariables)(h.value).then(function(){D("refresh"),a()}).finally(function(){i.value=!1})}).finally(function(){i.value=!1})}return{formData:h,loading:i,save:c,close:a,configFrom:p}},render(){var V=this;return(0,r.createVNode)(N.Dialog,{isShow:this.isShow,title:"\u5FEB\u901F\u521B\u5EFA\u8FC7\u6EE4",width:480,closeIcon:!this.loading,escClose:!1,quickClose:!1,onClosed:this.close},{default:function(){return(0,r.createVNode)(N.Form,{model:V.formData,"form-type":"vertical",ref:"configFrom",class:"pl-medium pr-medium"},{default:function(){return[(0,r.createVNode)(M,{label:"\u53D8\u91CF&\u5B57\u5178\u540D\u79F0",required:!0,property:"description"},{default:function(){return[(0,r.createVNode)(N.Input,{modelValue:V.formData.description,"onUpdate:modelValue":function(p){return V.formData.description=p},maxlength:16},null)]}}),(0,r.createVNode)(M,{label:"\u5F15\u7528\u522B\u540D(\u82F1\u6587)",property:"name",required:!0},{default:function(){return[(0,r.createVNode)(N.Input,{modelValue:V.formData.name,"onUpdate:modelValue":function(p){return V.formData.name=p},maxlength:16},null)]}}),(0,r.createVNode)(M,{label:"\u9ED8\u8BA4\u503C",class:"flex-1"},{default:function(){return[(0,r.createVNode)(N.Input,{modelValue:V.formData.default,"onUpdate:modelValue":function(p){return V.formData.default=p}},null)]}}),(0,r.createVNode)(M,{label:"\u6570\u636E\u91CF\u4E0A\u9650",property:"limit",class:"flex-1 mr-medium"},{default:function(){return[(0,r.createVNode)(N.Select,{modelValue:V.formData.limit,"onUpdate:modelValue":function(p){return V.formData.limit=p},allowCreate:!0,clearable:!1,list:[25,50,100,200,1e3].map(function(i){return{label:String(i),value:i}})},null)]}}),(0,r.createVNode)("div",{class:"pb-xxl"},[(0,r.createVNode)(N.Checkbox,{modelValue:V.formData.multiple,"onUpdate:modelValue":function(i){return V.formData.multiple=i}},{default:function(){return[(0,r.createTextVNode)("\u53EF\u591A\u9009")]}}),(0,r.createVNode)(N.Checkbox,{modelValue:V.formData.select_all,"onUpdate:modelValue":function(i){return V.formData.select_all=i}},{default:function(){return[(0,r.createTextVNode)("\u63D0\u4F9B\u201C\u5168\u90E8\u201D\u9009\u9879")]}})])]}})},footer:function(){return(0,r.createVNode)(r.Fragment,null,[(0,r.createVNode)(N.Button,{class:"mr-small",theme:"primary",loading:V.loading,onClick:V.save},{default:function(){return[(0,r.createTextVNode)("\u4FDD\u5B58")]}}),(0,r.createVNode)(N.Button,{disabled:V.loading,onClick:V.close},{default:function(){return[(0,r.createTextVNode)("\u53D6\u6D88")]}})])}})}});u.default=g},78186:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748),N=r(t(64375));t(37209),t(2968),t(19903),t(14775),t(58146);var d=t(12692),M=t(22247),g=t(82576);t(28534);var V=t(72993),s=r(t(97193)),D=r(t(71997));function h(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!(0,e.isVNode)(a)}var i=M.Form.ComposeFormItem,p=M.Select.Option,l=(0,e.defineComponent)({name:"VariationDictInput",props:{modelValue:{type:Object,default:function(){return new d.QueryVariation("","")},required:!0},table:{type:String,required:!0},list:{type:Array,default:[],required:!0}},emits:["update:modelValue","remove"],setup(a,c){var f=c.emit,v=(0,e.computed)({get:function(){return a.modelValue},set:function(o){return f("update:modelValue",o),o}}),n=(0,e.ref)(!1),m=(0,V.useRoute)(),S=m.params.space_uid,x=(0,e.ref)([]),T=(0,e.ref)(!0),B=(0,D.default)(),y=function(o,C){(0,g.useGetVariationByField)(o,C,S).then(function(b){x.value=b}).catch(function(b){(0,M.Message)({theme:"error",message:b?.message||"\u8BF7\u6C42\u53D8\u91CF\u51FA\u9519"})}).finally(function(){T.value=!1})};(0,e.watch)(function(){return[a.table,v.value.name]},function(U){var o=(0,N.default)(U,2),C=o[0],b=o[1];y(C,b)},{immediate:!0});function j(U){var o=a.list.find(function(C){return C.name===U});!o||(v.value.type=o.type)}return function(){var U,o,C;return(0,e.createVNode)("div",{class:"bv-has-btn-box dragging-handle position-relative flex-row align-items-center mr-normal"},[(0,e.createVNode)(i,null,{default:function(){return[(0,e.createVNode)(M.Select,{class:"bv-query-select-mini hide-select-angular",modelValue:v.value.name,"onUpdate:modelValue":function(P){return v.value.name=P},onChange:j,popoverMinWidth:220,inputSearch:!1,clearable:!1,filterable:!0,allowCreate:!1},h(C=a.list.map(function(F){return(0,e.createVNode)(p,{key:F.name,label:F.name,value:F.name},{default:function(){return[(0,e.createVNode)("div",{class:"flex-row align-items-center justify-content-between"},[(0,e.createVNode)("span",null,[F.name]),(0,e.createVNode)("div",{style:{fontSize:".8em"}},[F.type])])]}})}))?C:{default:function(){return[C]}}),(0,e.createVNode)(M.Select,{modelValue:v.value.variation,"onUpdate:modelValue":function(P){return v.value.variation=P},loading:T.value,class:"hide-select-angular"},{default:function(){return x.value.map(function(P){return(0,e.createVNode)(p,{key:P.variable_name,label:P.variable_desc,value:P.variable_name},null)})},extension:function(){return(0,e.createVNode)("div",{class:"flex-row full-width full-height justify-content-between align-items-center pl-medium pr-medium"},[(0,e.createVNode)("div",{class:"flex-row align-items-center cursor-pointer",onClick:function(){return n.value=!0}},[(0,e.createVNode)("i",{class:"bkvision-icon icon-add-line mr-min"},null),(0,e.createVNode)("span",null,[(0,e.createTextVNode)("\u5FEB\u901F\u521B\u5EFA")])]),(0,e.withDirectives)((0,e.createVNode)("i",{onClick:function(){return y(a.table,v.value.name)},class:"bkvision-icon icon-refresh text-lint-btn"},null),[[(0,e.resolveDirective)("bkTooltips"),{content:"\u5237\u65B0\u5217\u8868"}]])])}})]}}),(0,e.createVNode)(s.default,{isShow:n.value,onClose:function(){return n.value=!1},onRefresh:function(){return y(a.table,v.value.name)},params:{datasource_uid:(U=B.panel)===null||U===void 0||(o=U.datasource)===null||o===void 0?void 0:o.uid,datasource_table:a.table,field:v.value.name,space_uid:S}},null),(0,e.createVNode)("div",{onClick:function(){return f("remove")},class:"bv-target-input-btn flex-row align-items-center"},[(0,e.createVNode)("i",{class:"bkvision-icon icon-guanbi_mianxing"},null)])])}}});u.default=l},43277:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748),N=r(t(76948)),d=r(t(5642)),M=r(t(14799)),g=r(t(23963)),V=r(t(40297)),s=r(t(57422)),D=r(t(18809));function h(p,l,a){var c=(0,e.ref)(!0);return(0,e.createVNode)(e.Fragment,null,[(0,e.createVNode)(N.default,{key:l,renderType:"targets",list:a,modelValue:p.targets,"onUpdate:modelValue":function(v){return p.targets=v}},null),(0,e.createVNode)(N.default,{key:l,renderType:"dimensions",list:a,modelValue:p.dimensions,"onUpdate:modelValue":function(v){return p.dimensions=v}},null),(0,e.createVNode)(d.default,{list:a,modelValue:p.time_filter,"onUpdate:modelValue":function(v){return p.time_filter=v}},null),(0,e.createVNode)("div",null,[(0,e.createVNode)(s.default,{class:"mb-medium",modelValue:c.value,"onUpdate:modelValue":function(v){return c.value=v},renderDirective:"show",label:"\u8FC7\u6EE4\u4E0E\u6392\u5E8F"},{default:function(){return[(0,e.createVNode)(M.default,{list:a,modelValue:p.where,"onUpdate:modelValue":function(n){return p.where=n}},null),(0,e.createVNode)(g.default,{list:a,modelValue:p.order,"onUpdate:modelValue":function(n){return p.order=n}},null),(0,e.createVNode)(V.default,{modelValue:p.limit,"onUpdate:modelValue":function(n){return p.limit=n}},null)]}})]),(0,e.createVNode)("div",{class:"data-source-title",style:"margin-left:-24px;"},[(0,e.createTextVNode)("\u56FE\u8868\u7EC4\u4EF6")]),(0,e.createVNode)(D.default,{modelValue:p.variation,"onUpdate:modelValue":function(v){return p.variation=v},list:a,table:p.table},null)])}var i=h;u.default=i},7702:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=t(70748);t(34),t(37209),t(35340);var N=t(12692),d=t(22247),M=r(t(5642)),g=t(14712),V=r(t(35633)),s=r(t(19291)),D=d.Form.FormItem;function h(l,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"targets",f,v,n;c==="targets"?(v="\u6307\u6807",f=l.targets,n=a):(f=l.dimensions,v="\u7EF4\u5EA6",n=a.filter(function(x){var T=x.type;return T!=="f(x)"}));function m(x){f.push(new N.QueryColumn({name:x}))}function S(x){f.splice(x,1)}return(0,e.createVNode)(D,{label:v,required:c==="targets",class:"bv-form-item-wrap"},{default:function(){return[(0,e.createVNode)(s.default,{list:f,handle:".dragging-handle",tag:"div","item-key":"name",class:"flex-row align-items-center flex-wrap"},{item:function(B){var y=B.element,j=B.index;return(0,e.createVNode)("div",{key:y.name,class:"bv-target-input dragging-handle mr-normal position-relative"},[(0,e.createVNode)(V.default,{class:"full-width",modelValue:y.name,"onUpdate:modelValue":function(o){return y.name=o},options:n},null),(0,e.createVNode)("div",{onClick:function(){return S(j)},class:"bv-target-input-btn flex-row align-items-center"},[(0,e.createVNode)("i",{class:"bkvision-icon icon-guanbi_mianxing"},null)])])},footer:function(){return(0,e.createVNode)("div",{class:"bv-target-add-btn"},[(0,e.createVNode)(g.Plus,null,null),(0,e.createVNode)(V.default,{class:"bv-add-select",onChange:m,options:n,type:"add"},null)])}})]}})}function i(l,a,c){return(0,e.createVNode)(e.Fragment,null,[h(l,c,"targets"),h(l,c,"dimensions"),(0,e.createVNode)(M.default,{list:c,modelValue:l.time_filter,"onUpdate:modelValue":function(v){return l.time_filter=v}},null)])}var p=i;u.default=p},7586:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0,t(20148),t(50754),t(58146),t(37209);var e=t(70748),N=r(t(63638)),d=t(35385),M=t(64210),g=t(22247),V=r(t(53427)),s=r(t(56350)),D=r(t(13564)),h=r(t(43277)),i=r(t(7702));function p(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!(0,e.isVNode)(n)}var l=g.Collapse.CollapsePanel,a=g.Form.FormItem,c=g.Select.Option,f=class extends(0,M.TSX)()(s.default){constructor(){super(...arguments),(0,N.default)(this,"formData",[]),(0,N.default)(this,"panelModel",void 0)}resetQuery(m,S){if(!S){this.tableColumns[S]=[];return}this.formData[m].targets=[],this.formData[m].dimensions=[],this.formData[m].where=[],this.formData[m].order=[],this.formData[m].variation=[]}changeTable(m,S){this.resetQuery(m,S),this.getColumns(m,S)}render(){var m=this;if(this.loading)return(0,e.createVNode)("div",{class:"loading-placeholder-box"},[(0,e.createVNode)(V.default,null,null)]);var S=function(y){if(!!y.raw_query)return(0,e.createVNode)("div",{class:"monaco-editor-box"},[(0,e.createVNode)(D.default,{width:"100%",height:"100%",theme:"vs-dark",options:{minimap:{enabled:!1},formatOnPaste:!0},language:"sql",modelValue:y.query_text,"onUpdate:modelValue":function(U){return y.query_text=U}},null)])},x=function(y,j){if(!y.raw_query){if(!y.table)return(0,e.createVNode)(g.Exception,{class:"exception-wrap-item exception-part",type:"empty",scene:"part"},{default:function(){return[(0,e.createVNode)("span",null,[(0,e.createTextVNode)("\u8BF7\u9009\u62E9\u6570\u636E\u8868")])]}});if(m.loadingColumns)return(0,e.createVNode)("div",{class:"loading-placeholder-box"},[(0,e.createVNode)(V.default,{title:"\u52A0\u8F7D\u8868\u5B57\u6BB5\u4E2D\u2026\u2026"},null)])}var U=m.tableColumns[y.table];return y.raw_query?(0,i.default)(y,j,U||[]):(0,h.default)(y,j,U)},T=function(y,j){return(0,e.createVNode)(l,{key:j,name:j,modelValue:m.expendList[j],"onUpdate:modelValue":function(o){return m.expendList[j]=o},class:"mb-normal"},{header:function(){return(0,e.createVNode)("header",{class:"data-source-collapse-head"},[(0,e.createVNode)("i",{class:"bkvision-icon mr-min ".concat(m.expendList[j]?"icon-angle-up-fill-3":"icon-angle-right-fill")},null),(0,e.createVNode)((0,e.resolveComponent)("stong"),null,{default:function(){return[y.ref_id]}})])},content:function(){var o,C,b;return(0,e.createVNode)(g.Form,{class:"data-source-form","label-width":70,model:y},{default:function(){return[(0,e.createVNode)(a,{"label-width":112,label:"\u5F00\u542FSQL\u6A21\u5F0F"},{default:function(){return[(0,e.createVNode)("div",{class:"flex-row align-items-center"},[(0,e.createVNode)(g.Switcher,{value:y.raw_query,theme:"primary",onChange:function(I){return m.changeSqlModel(y,I)}},null),(0,e.createVNode)(g.Alert,{class:"flex-1 ml-normal",theme:y.raw_query?"warning":"info",title:y.raw_query?"\u60A8\u5DF2\u5F00\u542FSQL\u6A21\u5F0F\uFF0C\u5982\u60A8\u5DF2\u5BF9\u8BED\u53E5\u8FDB\u884C\u4FEE\u6539\uFF0C\u53EF\u80FD\u65E0\u6CD5\u5B8C\u7F8E\u5207\u6362\u56DE\u7B80\u6613\u6A21\u5F0F":"\u5982\u679C\u60A8\u6709\u590D\u6742\u7684\u67E5\u8BE2\u9700\u6C42\uFF0C\u8BF7\u4F7F\u7528SQL\u6A21\u5F0F\u624B\u52A8\u5F55\u5165\u67E5\u8BE2\u8BED\u53E5"},null)])]}}),(0,e.createVNode)(a,null,p(C=S(y))?C:{default:function(){return[C]}}),m.panelModel.datasource.type==="lesscode"?(0,e.createVNode)(a,{label:"\u73AF\u5883",required:!y.raw_query},{default:function(){return[(0,e.createVNode)(g.Select,{placeholder:"\u8BF7\u9009\u62E9lesscode\u73AF\u5883",class:"source-select-item",filterable:!0,clearable:!1,modelValue:y.env,"onUpdate:modelValue":function(I){return y.env=I},inputSearch:!1},p(b=m.envs.map(function(w){return(0,e.createVNode)(c,{value:w.id,label:w.name,key:w.id},null)}))?b:{default:function(){return[b]}})]}}):"",(0,e.createVNode)(a,{label:"\u6570\u636E\u8868",required:!y.raw_query},{default:function(){return[(0,e.createVNode)(g.Select,{placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u8868",class:"source-select-item",filterable:!0,list:m.tableList,clearable:y.raw_query,modelValue:y.table,"onUpdate:modelValue":function(I){return y.table=I},enableVirtualRender:!0,inputSearch:!1,onChange:function(I){return m.changeTable(j,I)}},null)]}}),m.panelModel.datasource.type==="bkbase"?(0,e.createVNode)(a,{label:"\u5B58\u50A8",required:!y.raw_query},{default:function(){return[(0,e.createVNode)(g.Select,{placeholder:"\u8BF7\u9009\u62E9\u5B58\u50A8",class:"source-select-item",filterable:!0,clearable:!1,modelValue:y.storage,"onUpdate:modelValue":function(I){return y.storage=I},inputSearch:!1},{default:function(){return[(o=m.storage[y.table])===null||o===void 0?void 0:o.map(function(I){return(0,e.createVNode)(c,{value:I.name,label:I.name,key:I.id},null)})]}})]}}):"",x(y,j)]}})}})};return this.formData.map(function(B,y){return T(B,y)})}};(0,d.__decorate)([(0,M.Prop)()],f.prototype,"panelModel",void 0),f=(0,d.__decorate)([(0,M.Component)({name:"QueryPanelMySQL",emits:["query"]})],f);var v=f;u.default=v},92141:function(R,u,t){var r=t(38600);Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var e=r(t(7586)),N=e.default;u.default=N}}]);
